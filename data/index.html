<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Temperature Monitor</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞) -->
    <script src="chart.min.js"></script>
    <script src="chartjs-plugin-zoom.min.js"></script>
    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–ª–∞–≥–∏–Ω –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è Chart.js v4
        if (typeof Chart !== 'undefined') {
            // –ü–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            // –ù–æ –º–æ–∂–Ω–æ —è–≤–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            try {
                if (typeof zoomPlugin !== 'undefined') {
                    Chart.register(zoomPlugin);
                }
            } catch(e) {
                console.log('Zoom plugin will be registered automatically');
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <h1 style="margin: 0;">üå°Ô∏è ESP32 Temperature Monitor</h1>
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <div id="wifi-status-header" style="display: flex; align-items: center; gap: 8px;">
                        <div id="wifi-icon" style="font-size: 1.5rem;">üì∂</div>
                        <div id="wifi-rssi-header" style="font-size: 0.875rem; opacity: 0.9;">--</div>
                    </div>
                    <div id="ip-address-header" style="font-size: 0.875rem; opacity: 0.9; font-family: 'Courier New', monospace;">--</div>
                    <div id="uptime-header" style="font-size: 0.875rem; opacity: 0.9;">‚è±Ô∏è <span id="uptime-header-value">--</span></div>
                    <!-- –°—Ç–∞—Ç—É—Å MQTT -->
                    <div id="mqtt-status-header" style="display: flex; align-items: center; gap: 5px; font-size: 0.875rem;">
                        <span style="opacity: 0.9;">MQTT</span>
                        <div id="mqtt-status-dot" style="width: 10px; height: 10px; border-radius: 50%; background: #f44336; display: inline-block;"></div>
                    </div>
                    <!-- –°—Ç–∞—Ç—É—Å Telegram -->
                    <div id="telegram-status-header" style="display: flex; align-items: center; gap: 5px; font-size: 0.875rem;">
                        <span style="opacity: 0.9;">Telegram</span>
                        <div id="telegram-status-dot" style="width: 10px; height: 10px; border-radius: 50%; background: #f44336; display: inline-block;"></div>
                    </div>
                    <a href="/settings.html" style="color: white; text-decoration: none; opacity: 0.9; font-size: 0.9rem; padding: 8px 16px; background: rgba(255, 255, 255, 0.2); border-radius: 8px; display: inline-block;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <!-- –°–µ—Ç–∫–∞ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–æ–≤ -->
            <div class="tile tile-large sensors-grid-container">
                <div class="tile-header">
                    <span class="tile-icon">üå°Ô∏è</span>
                    <span class="tile-title">–¢–µ—Ä–º–æ–º–µ—Ç—Ä—ã</span>
                </div>
                <div class="tile-content">
                    <div id="sensors-grid" class="sensors-grid">
                        <!-- –Ø—á–µ–π–∫–∏ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
            
            <div class="tile tile-large chart-tile">
                <div class="tile-header">
                    <span class="tile-icon">üìä</span>
                    <span class="tile-title">–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</span>
                    <div style="margin-left: auto; display: flex; gap: 5px; flex-wrap: wrap;">
                        <button onclick="loadChart('1m')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">1–º</button>
                        <button onclick="loadChart('5m')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">5–º</button>
                        <button onclick="loadChart('15m')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">15–º</button>
                        <button onclick="loadChart('30m')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">30–º</button>
                        <button onclick="loadChart('1h')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">1—á</button>
                        <button onclick="loadChart('6h')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">6—á</button>
                        <button onclick="loadChart('24h')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">24—á</button>
                        <button onclick="loadChart('7d')" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: white; cursor: pointer;">7–¥</button>
                        <button onclick="resetChartZoom()" style="padding: 4px 8px; font-size: 0.75rem; border: 1px solid #e0e0e0; border-radius: 4px; background: #f5f5f5; cursor: pointer;" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">‚Ü∫</button>
                    </div>
                </div>
                <div class="tile-content">
                    <div id="chart-sensors-select" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 10px;"></div>
                    <canvas id="temperatureChart" style="max-height: 300px;"></canvas>
                    <div id="chart-unavailable" style="display: none; text-align: center; padding: 40px; color: #666;">
                        –ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Chart.js)
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–∞ -->
        <div id="sensor-settings-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-sensor-name">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–∞</h2>
                    <button class="modal-close" onclick="closeSensorSettings()">&times;</button>
                </div>
                <form id="sensor-settings-form" class="modal-form">
                    <input type="hidden" id="modal-sensor-id" value="">
                    
                    <div class="form-group">
                        <label for="modal-sensor-name-input">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–æ–º–µ—Ç—Ä–∞</label>
                        <input type="text" id="modal-sensor-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-sensor-mode">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</label>
                        <select id="modal-sensor-mode" onchange="updateSensorModeSettings(this.value)">
                            <option value="monitoring">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</option>
                            <option value="alert">–û–ø–æ–≤–µ—â–µ–Ω–∏–µ</option>
                            <option value="stabilization">–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è</option>
                        </select>
                    </div>
                    
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
                    <div id="modal-monitoring-settings" class="mode-settings-group" style="display: none;">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
                        <div class="form-group">
                            <label for="modal-monitoring-interval">–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–∫—É–Ω–¥—ã)</label>
                            <input type="number" id="modal-monitoring-interval" min="1" max="3600" value="5">
                            <small>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –ø–æ–∫–∞–∑–∞–Ω–∏–π –≤ Telegram/MQTT</small>
                        </div>
                    </div>
                    
                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è -->
                    <div id="modal-alert-settings" class="mode-settings-group" style="display: none;">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è</h3>
                        <div class="form-group">
                            <label for="modal-alert-min-temp">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</label>
                            <input type="number" id="modal-alert-min-temp" step="0.1" min="-55" max="125" value="10.0">
                        </div>
                        <div class="form-group">
                            <label for="modal-alert-max-temp">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</label>
                            <input type="number" id="modal-alert-max-temp" step="0.1" min="-55" max="125" value="30.0">
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="modal-alert-buzzer" checked> –í–∫–ª—é—á–∏—Ç—å –±–∏–ø–µ—Ä –ø—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ</label>
                        </div>
                    </div>

                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ -->
                    <div id="modal-stabilization-settings" class="mode-settings-group" style="display: none;">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</h3>
                        <p style="font-size: 0.85em; color: #666; margin-bottom: 15px;">
                            –†–µ–∂–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ —Å–æ–æ–±—â–∞–µ—Ç –æ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–∞—Ö.
                            –ü–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∏–∑-–∑–∞ –∞—Ç–º. –¥–∞–≤–ª–µ–Ω–∏—è) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.
                        </p>
                        <div class="form-group">
                            <label for="modal-stab-tolerance">–î–æ–ø—É—Å–∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (¬∞C)</label>
                            <input type="number" id="modal-stab-tolerance" step="0.01" min="0.01" max="5" value="0.1">
                            <small>–ú–∞–∫—Å. —Ä–∞–∑–±—Ä–æ—Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –ø—Ä–∏–∑–Ω–∞–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏</small>
                        </div>
                        <div class="form-group">
                            <label for="modal-stab-alert-threshold">–ü–æ—Ä–æ–≥ —Ç—Ä–µ–≤–æ–≥–∏ (¬∞C)</label>
                            <input type="number" id="modal-stab-alert-threshold" step="0.01" min="0.05" max="10" value="0.2">
                            <small>–†–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫ –æ—Ç –±–∞–∑–æ–≤–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —Ç—Ä–µ–≤–æ–≥–∏</small>
                        </div>
                        <div class="form-group">
                            <label for="modal-stab-duration">–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" id="modal-stab-duration" value="10" min="1" max="60">
                            <small>–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</small>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="modal-stab-buzzer" checked> –í–∫–ª—é—á–∏—Ç—å –±–∏–ø–µ—Ä –ø—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><input type="checkbox" id="modal-send-to-networks" checked> –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MQTT/Telegram</label>
                    </div>
                    
                    <div class="modal-buttons">
                        <button type="button" class="btn btn-primary" onclick="saveSensorSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-secondary" onclick="closeSensorSettings()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
        
        <footer>
            <div class="update-info">
                <span>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-update">--</span></span>
                <div style="margin-top: 10px;">
                    <a href="/settings.html" style="color: white; text-decoration: none; opacity: 0.9;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                </div>
                <div style="margin-top: 8px; font-size: 0.85em; opacity: 0.7;">
                    <span id="firmware-version">v--</span> |
                    Heap: <span id="heap-usage">--%</span> |
                    SPIFFS: <span id="spiffs-usage">--%</span>
                </div>
            </div>
        </footer>
    </div>
    
    <script src="script.js"></script>
</body>
</html>
