# Changelog

Все значимые изменения в проекте ESP32 Temperature Monitor будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [Неопубликовано]

### Добавлено
- Поддержка до 10 датчиков температуры с индивидуальными настройками
- Режимы работы для каждого датчика: monitoring, alert, stabilization
- Новая логика стабилизации: отслеживание колебаний температуры
- История температуры с сохранением в SPIFFS (до 288 записей)
- Управление питанием WiFi для экономии энергии
- Watchdog Timer для защиты от зависаний
- Асинхронная обработка Telegram и MQTT в отдельных FreeRTOS задачах
- Полная документация API (API.md)
- Расширенная документация в README.md
- **Интерактивная настройка через Telegram** (`/setup`, `/cancel`) - пошаговая настройка режимов работы
- Статический пул сообщений для Telegram (предотвращение фрагментации heap)
- Индексация конфигураций датчиков для O(1) поиска вместо O(n²)

### Изменено
- Обновлена логика стабилизации: теперь отслеживаются колебания температуры, а не конкретная целевая температура
- **Упрощены глобальные настройки стабилизации**: убран `targetTemp` (используется per-sensor), осталось 3 параметра: `tolerance`, `alertThreshold`, `duration`
- Команда `/stab_set` теперь принимает параметры в секундах: `/stab_set [tolerance] [alert] [duration_sec]`
- Улучшена производительность: неблокирующие операции, кеширование настроек
- Оптимизировано использование памяти
- Заменены volatile флаги на мьютексы для thread-safe доступа

### Исправлено
- **Stack Overflow в saveSettings()**: заменено 3x StaticJsonDocument<8192> (24KB на stack) на последовательную обработку с DynamicJsonDocument на heap
- **Утечка памяти в temperature_history.cpp**: исправлен порядок операций при перераспределении буфера
- **Race conditions**: добавлен SemaphoreHandle_t для защиты общих флагов
- Исправления ошибок сохранения в веб-интерфейсе
- Устранение уязвимостей веб-сервера: оптимизация операций, таймауты, кеширование
- Улучшена стабильность WiFi подключения
- Исправлена обработка ошибок DNS lookup

## [1.0.0] - 2024-01-26

### Добавлено
- Базовая функциональность мониторинга температуры
- Поддержка датчиков DS18B20
- OLED дисплей 128x32
- Веб-интерфейс для настройки и мониторинга
- Telegram бот с командами управления
- MQTT интеграция
- Режимы работы: local, monitoring, alert, stabilization
- Управление кнопкой
- Зуммер для оповещений
- Мониторинг батареи (опционально)

---

## Типы изменений

- **Добавлено** - для новых функций
- **Изменено** - для изменений в существующей функциональности
- **Устарело** - для функций, которые скоро будут удалены
- **Удалено** - для удаленных функций
- **Исправлено** - для исправления ошибок
- **Безопасность** - для уязвимостей
